<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Users - Admin</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header><h1>Admin – Manage Users</h1><nav id="navLinks"></nav></header>
  <main>
    <div style="max-width:1000px;margin:2rem auto;">
      <div id="usersList">Loading users...</div>
    </div>
  </main>
  <footer><p>© 2025 HireMeNow</p></footer>

  <script src="js/auth.js"></script>
  <script>
    setupAuth().then(user => {
      if (user.role !== "admin") location.href = "/jobs.html";
      loadUsers();
    });

    async function loadUsers() {
      const res = await fetch("/api/admin/users", { headers: { Authorization: `Bearer ${localStorage.token}` }});
      const users = await res.json();
      document.getElementById("usersList").innerHTML = `
        <table style="width:100%;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.06);">
          <thead style="background:#2c3e50;color:#fff;"><tr>
            <th style="padding:1rem;">ID</th>
            <th>Name</th><th>Email</th><th>Role</th><th>Action</th>
          </tr></thead>
          <tbody>
            ${users.map(u => `
              <tr style="border-bottom:1px solid #eee;">
                <td style="padding:1rem;">${u.id}</td>
                <td>${u.name}</td>
                <td>${u.email}</td>
                <td>${u.role}</td>
                <td>
                  <button onclick="deleteUser(${u.id})" style="background:#c0392b;padding:.4rem .8rem;">Delete</button>
                </td>
              </tr>`).join("")}
          </tbody>
        </table>`;
    }

    async function deleteUser(id) {
      if (!confirm("Delete this user?")) return;
      await fetch(`/api/admin/users/${id}`, { method: "DELETE", headers: { Authorization: `Bearer ${localStorage.token}` }});
      loadUsers();
    }
  </script>
</body>
</html>